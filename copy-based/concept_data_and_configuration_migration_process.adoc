---
permalink: copy-based/concept_data_and_configuration_migration_process.html 
sidebar: sidebar 
keywords: ontap, copy, based, transition, data, configuration, migration, process 
summary: 使用 7- 模式过渡工具的数据和配置迁移过程包括以下阶段：准备，基线数据复制，应用配置 \ （预转换 \ ）和存储转换。如果您有用于监管链验证的 SnapLock 卷，则监管链验证是转换后的额外阶段。 
---
= 数据和配置迁移过程
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
使用 7- 模式过渡工具的数据和配置迁移过程包括以下阶段：准备，基线数据复制，应用配置（预转换）和存储转换。如果您有用于监管链验证的 SnapLock 卷，则监管链验证是转换后的额外阶段。

下图显示了迁移过程中的不同阶段：

image::../media/transition_operational_flow.gif[过渡操作流]



== 准备

在此阶段，将运行预检来验证功能功能。此过程会检查 7- 模式存储系统，以验证卷和配置是否已准备好迁移到 ONTAP 。它会检查集群是否配置正确，并支持过渡。在继续过渡之前，必须解决所有错误。尽管该工具允许您在不解决警告的情况下继续操作，但在继续过渡之前，您必须了解警告的影响。您可以多次运行预检，以验证所有错误是否均已解决。

尽管评估期间执行的预检步骤和评估步骤看起来相似，但也存在差异。预检步骤是一个更详细的测试，主要针对已确定为迁移源（ 7- 模式）和目标（ ONTAP ）系统的特定存储系统。此评估步骤仅评估迁移源系统，并检查与 ONTAP 的特性和功能差异。



== 基线数据复制

在 SVM 上创建新卷，在 7- 模式卷和 ONTAP 卷之间建立 SnapMirror 关系，并执行基线传输。基线完成后，增量传输将根据用户定义的数据复制计划自动运行。完成此步骤后，访问源存储的客户端和服务器将保持联机状态。

复制数据需要 CPU ，内存和存储访问，这会导致源存储系统上使用更多资源。最佳做法是，将数据复制活动计划在非高峰期进行（最好是 CPU 使用率约为 50% ）。



== 应用配置（预转换）

此阶段包括 SnapMirror 增量传输；配置信息将应用于 ONTAP 系统， SVM 和卷。您也可以选择在存储转换之前测试要过渡的 ONTAP 卷。

尽管应用了大多数配置，但某些操作会推迟到存储转换：例如，应用配额。

为过渡选择的 7- 模式 IP 地址将在管理关闭状态下创建。为过渡选择的新 IP 地址将在管理启动状态下创建。这些新 IP 地址可用于在预转换测试期间验证数据访问。

最佳做法是，在计划转换窗口之前几天或几周运行应用配置（预转换）阶段。此活动有助于验证是否已正确应用所有配置以及是否需要进行任何更改。


TIP: 虽然不需要进行增量更新，但最佳做法是尽可能在接近存储转换的位置执行增量传输，以最大限度地缩短客户端断开连接的时间。



== 存储转换

在存储转换期间，从较高的层面来看，客户端会断开连接，执行最终数据传输， SnapMirror 关系会断开，而客户端会手动重新连接。

断开客户端或服务器与源存储卷的连接可防止在执行最终副本时执行额外的写入操作。断开客户端连接之前，最佳做法是执行增量更新，以最大限度地减少停机时间。

只能为要迁移的卷断开存储访问。可以从存储端或客户端中断对存储的访问。最佳做法是从存储端断开连接。例如，如果 CIFS 客户端正在访问 7- 模式存储系统上名为 "`user01` " 的卷，则可以使用 `cifs terminate -v user01` 命令禁用对卷上所有 CIFS 共享的访问（从存储端停止客户端访问）。迁移可能会导致 IP 地址，挂载点甚至共享名称发生更改，因此客户端访问也可能会中断。只要客户端无法向要迁移的存储容器写入任何新数据，您就可以使用其中一种或两种方法来停止访问。

断开客户端连接后， 7- 模式过渡工具将执行最终副本，以使源数据集和目标数据集处于奇偶校验状态。7- 模式过渡工具可在 SVM 上配置数据 LIF 。此时，在预转换期间未过渡的某些配置更改（例如应用 SAN 配置和配额）也会应用于 SVM 。

存储转换完成后，您可以手动重新连接客户端并验证数据访问。验证数据访问涉及验证客户端是否正确访问 ONTAP 系统以及所有权限是否按预期工作。



== SnapLock 卷的监管链验证

过渡完成后，您可以为项目中的 SnapLock 卷触发监管链操作。此操作不是必需操作，只有在监管链验证对于 SnapLock 卷过渡至关重要时，才需要执行此操作。您可以对项目中的所有 SnapLock 卷或项目中的一部分 SnapLock 卷执行此操作。合规性卷和企业级 SnapLock 卷均支持监管链验证。只有读写 SnapLock 卷才支持监管链验证，只读 SnapLock 卷不支持监管链验证。


IMPORTANT: 文件名包含非 ASCII 字符的 SnapLock 卷不支持监管链验证。

验证工作流仅在 7- 模式过渡工具 GUI 中受支持，在 CLI 工作流中不受支持。

监管链验证操作将执行以下操作：

* 枚举 7- 模式卷中的所有 WORM 文件
* 计算先前枚举的每个 WORM 文件的指纹 7- 模式卷和过渡后的 ONTAP 卷
* 生成一个报告，其中详细介绍指纹匹配和不匹配的文件数以及不匹配的原因


所有 WORM 文件的指纹数据存储在规划阶段提供的 ONTAP 卷中。


NOTE: 根据 7- 模式卷上的文件数量，监管链验证过程可能需要大量时间（天或周）。
